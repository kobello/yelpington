<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Yelpington App</title>
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
  <script src="main.js"></script> -->
</head>
<style>
  h1 {
    color: red;
  }
</style>

<body>
  <a href="/">Home</a>
  <h1></h1>
  <div id="list1"></div>
  <div id="list2"></div>
  <div id="list3"></div>
  <div id="list4"></div>
  <div id="list5"></div>
  <div id="list6"></div>
  <div id="list7"></div>

  <div id="address1"></div>
  <br>
  <div id="phone"></div>
  <br>
  <h2 id="hourH"></h2>
  <div id="hours"></div>
  <br>
  <div id="notes"></div>
  <br>
  <br>
  <br>
  <div id="map"></div>

  <script>

    let params = new URLSearchParams(document.location.search.slice(1));
    let name = params.get("name");
    let data;
    let list;
    if (document.location.search == "") {
      console.log("It worked!")
      fetch('list.json')
        .then(function (response) {
          return response.text();
        })
        .then(function (myText) {
          resturantList = JSON.parse(myText)

          // for (i=0; i < resturantList.length)
          document.getElementById("list1").innerHTML = "<a href=/?name="+ resturantList.list1.id +">" +resturantList.list1.names+"</a>"

          document.getElementById("list2").innerHTML = "<a href=/?name="+ resturantList.list2.id +">" +resturantList.list2.names+"</a>"

          document.getElementById("list3").innerHTML = "<a href=/?name="+ resturantList.list3.id +">" +resturantList.list3.names+"</a>"

          document.getElementById("list4").innerHTML = "<a href=/?name="+ resturantList.list4.id +">" +resturantList.list4.names+"</a>"

          document.getElementById("list5").innerHTML = "<a href=/?name="+ resturantList.list5.id +">" +resturantList.list5.names+"</a>"

          document.getElementById("list6").innerHTML = "<a href=/?name="+ resturantList.list6.id +">" +resturantList.list6.names+"</a>"

          document.getElementById("list7").innerHTML = "<a href=/?name="+ resturantList.list7.id +">" +resturantList.list7.names+"</a>"

        })

    } else {
      fetch(name + '.json')
        .then(function (response) {
          return response.text();
        })
        .then(function (myText) {

          data = JSON.parse(myText)
          document.querySelector('h1').innerHTML = data.name
          document.getElementById('phone').innerHTML = "<h2>Phone: </h2><br>" + data["phone number"]
          document.getElementById('address1').innerHTML = "<h2>Address: </h2><br>" + data.address
          if (Array.isArray(data.hours)) {
            document.getElementById('hourH').textContent = "Hours: "
            for (let i = 0; i < data.hours.length; i++) {

              document.getElementById('hours').innerHTML += data.hours[i] + "<br>"

            }
          } else {
            document.getElementById('hours').innerHTML = "<h2>Hours: </h2><br>" + data.hours
          }
          document.getElementById('notes').innerHTML = "<h2>Notes: </h2><br>" + data.notes

        })
        .then(function () {

          let addressArray = data.address.split(" ")

          let location = addressArray.join("+")

          let url = "https://nominatim.openstreetmap.org/search?q=" + location + "&format=json"
          fetch(url)
            .then(function (response) {
              console.log(url)
              return response.json();
            })
            .then(function (myJSON) {
              firstBbox = myJSON[0].boundingbox[0]
              secondBbox = myJSON[0].boundingbox[1]
              thirdBbox = myJSON[0].boundingbox[2]
              fourthBbox = myJSON[0].boundingbox[3]
              document.getElementById("map").innerHTML = "<h2>Location: </h2><br>" + '<iframe id="inlineFrameExample" title="Inline Frame Example" width="300" height="200" src="https://www.openstreetmap.org/export/embed.html?bbox=' + thirdBbox + "," + firstBbox + "," + fourthBbox + "," + secondBbox + '&layer=mapnik"></iframe>'
            })

        });
    }
  </script>

</body>

</html>